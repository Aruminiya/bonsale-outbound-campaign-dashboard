server {
  listen 3030;                        # 監聽 3030 port
  server_name  localhost;             # 伺服器名稱

  # 前端靜態檔案與 SPA 路由
  location / {
    root /usr/share/nginx/html;       # 靜態檔案根目錄
    index index.html;                 # 預設首頁
    try_files $uri $uri/ /index.html; # 支援 SPA 路由，找不到檔案時回傳 index.html
  }

  # API 反向代理，將 /api/ 開頭的請求轉發到後端 3020 port
  location /api/ {
    proxy_pass http://localhost:3020/;    # 代理到後端 API
    proxy_set_header Host $host;          # 傳遞 Host 標頭
    proxy_set_header X-Real-IP $remote_addr;             # 傳遞用戶端真實 IP
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 傳遞轉發鏈上的 IP
  }

  # WebSocket 代理：/ws/projectOutbound
  location /ws/projectOutbound {
    proxy_pass http://localhost:3020;     # 代理到 WebSocket 服務 3020 port
    proxy_http_version 1.1;               # 使用 HTTP/1.1 支援 WebSocket
    proxy_set_header Upgrade $http_upgrade;   # 必要的 WebSocket 升級標頭
    proxy_set_header Connection "upgrade";    # 必要的 WebSocket 升級標頭
    proxy_set_header Host $host;              # 傳遞 Host 標頭
    proxy_set_header X-Real-IP $remote_addr;  # 傳遞用戶端真實 IP
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 傳遞轉發鏈上的 IP
  }

  # WebSocket 代理：/ws/outboundCampaigm
  location /ws/outboundCampaigm {
    proxy_pass http://localhost:3020;     # 代理到 WebSocket 服務 3020 port
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # WebSocket 代理：/ws/bonsaleWebHook
  location /ws/bonsaleWebHook {
    proxy_pass http://localhost:3020;     # 代理到 WebSocket 服務 3020 port
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  include /etc/nginx/mime.types;          # 載入 mime 類型設定
  default_type application/octet-stream;  # 預設檔案型態
}